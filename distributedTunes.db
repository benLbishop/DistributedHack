PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE user(
  id            integer     PRIMARY KEY  AUTOINCREMENT,
  first_name    text    NOT NULL,
  last_name     text    NOT NULL,
  email         text    UNIQUE  NOT NULL,
  password      text    NOT NULL,
  user_name     text    UNIQUE  NOT NULL,
  biography     text,
  profile_pic   text,
  join_date     datetime DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE wallet(
  user_id       integer       NOT NULL,
  address       char(42)  UNIQUE  NOT NULL,
  FOREIGN KEY(user_id) REFERENCES user(id)
);
CREATE TABLE album(
  id            integer     PRIMARY KEY  AUTOINCREMENT,
  name          text    NOT NULL,
  artist_id     integer     NOT NULL,
  genre         text    NOT NULL,
  release_date  datetime  NOT NULL,
  cover_art     text,
  FOREIGN KEY(artist_id) REFERENCES user(id)
  CONSTRAINT unique_album_by_artist UNIQUE (name, artist_id)
);
CREATE TABLE track(
  id            integer     PRIMARY KEY  AUTOINCREMENT,
  name          text    NOT NULL,
  length        text    NOT NULL,
  album_id      integer     NOT NULL,
  track_path    text    NOT NULL,
  upload_date   datetime  DEFAULT CURRENT_TIMESTAMP,
  play_price    integer     NOT NULL,
  plays         integer     DEFAULT 0,
  FOREIGN KEY(album_id) REFERENCES album(id)
);
COMMIT;
